[gd_scene load_steps=16 format=3 uid="uid://bv4ht8mgdetr8"]

[ext_resource type="Script" uid="uid://bajhxofytc8oh" path="res://minigame.gd" id="1_ioj25"]
[ext_resource type="Texture2D" uid="uid://bipj3bslg003i" path="res://minigames/8_59_Breakfast/sprites/background.png" id="3_ewha7"]
[ext_resource type="Texture2D" uid="uid://tovxpsg41m8m" path="res://minigames/8_59_Breakfast/sprites/breadroll.png" id="3_vgw02"]
[ext_resource type="Texture2D" uid="uid://gdltb20nan27" path="res://minigames/8_59_Breakfast/sprites/bottomarea.png" id="4_5i65a"]
[ext_resource type="Texture2D" uid="uid://cll3r1qwnrmpg" path="res://minigames/8_59_Breakfast/sprites/base.png" id="5_0l1d5"]
[ext_resource type="Texture2D" uid="uid://clq1alvplbg3a" path="res://minigames/8_59_Breakfast/sprites/door closed.png" id="6_qrew8"]
[ext_resource type="Texture2D" uid="uid://da74h688wxsqd" path="res://minigames/8_59_Breakfast/sprites/door open.png" id="7_sgvae"]
[ext_resource type="Texture2D" uid="uid://tueldydjxpen" path="res://minigames/8_59_Breakfast/sprites/freezer.png" id="8_0l1d5"]
[ext_resource type="Texture2D" uid="uid://bcfclxim8rh0n" path="res://minigames/8_59_Breakfast/sprites/items/dkflag.png" id="9_qrew8"]

[sub_resource type="GDScript" id="GDScript_sgjaw"]
script/source = "extends Node2D

var hovered_object : RigidBody2D = null
var held_object : RigidBody2D = null

func _input(event: InputEvent) -> void:
	var mouse_event = event as InputEventMouseButton
	if event is InputEventMouseButton:
		if mouse_event.button_index != MOUSE_BUTTON_LEFT:
			return
	else:
		return
		
	if mouse_event.pressed and hovered_object != null: 
		held_object = hovered_object
		held_object.freeze = true
	elif held_object != null: 
		held_object.global_position = get_global_mouse_position()
		#var mouse_speed = (get_global_mouse_position() - held_object.global_position) / get_physics_process_delta_time()
		#held_object.linear_velocity = mouse_speed
		#held_object.angular_velocity = 0
		held_object.freeze = false
		held_object = null
		
func _physics_process(_delta: float) -> void:
	if held_object == null:
		picking()
	else: 
		holding()
	
func picking():
	var mouse_pos = get_viewport().get_mouse_position()
	var space_state = get_world_2d().direct_space_state

	var query = PhysicsPointQueryParameters2D.new()
	query.position = mouse_pos
	query.collide_with_areas = true
	query.collide_with_bodies = true

	var results = space_state.intersect_point(query, 1)
	
	for result in results:
		if result.collider is RigidBody2D:
			hovered_object = result.collider
			return
	hovered_object = null
	
func holding():
	var target_pos = get_global_mouse_position()
	var motion = target_pos - held_object.global_position
	held_object.move_and_collide(motion) 

func win():
	CurrentGame.instance.win_and_finish(1.0)
	
"

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_sgjaw"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_sgjaw"]
size = Vector2(296.16785, 8.940582)

[sub_resource type="GDScript" id="GDScript_ewha7"]
resource_name = "Breadroll"
script/source = "extends RigidBody2D

func _ready() -> void:
	set_global_scale(Vector2.ONE * randf())

    body_entered.connect(_on_body_entered)

func _on_body_entered(body: Node) -> void:
	if body is RigidBody2D:
		print(\"Collided with:\", body.name)
"

[sub_resource type="CircleShape2D" id="CircleShape2D_ca2cv"]
radius = 33.06055

[sub_resource type="CircleShape2D" id="CircleShape2D_0l1d5"]
radius = 39.0

[node name="8_59_Breakfast" type="Node"]
script = ExtResource("1_ioj25")
title = "8:59 Breakfast"
mouse = 2
metadata/_custom_type_script = "uid://bajhxofytc8oh"

[node name="Controller" type="Node2D" parent="."]
script = SubResource("GDScript_sgjaw")

[node name="Background" type="Sprite2D" parent="."]
position = Vector2(480, 360)
texture = ExtResource("3_ewha7")

[node name="Floor" type="StaticBody2D" parent="Background"]
position = Vector2(13.000001, 353)
rotation = -0.016281746

[node name="CollisionShape2D" type="CollisionShape2D" parent="Background/Floor"]
shape = SubResource("WorldBoundaryShape2D_sgjaw")

[node name="Ceiling" type="StaticBody2D" parent="Background"]
position = Vector2(7, -360)
rotation = -3.1415925

[node name="CollisionShape2D" type="CollisionShape2D" parent="Background/Ceiling"]
shape = SubResource("WorldBoundaryShape2D_sgjaw")

[node name="WallRight" type="StaticBody2D" parent="Background"]
position = Vector2(480, -3)
rotation = -1.5707964

[node name="CollisionShape2D" type="CollisionShape2D" parent="Background/WallRight"]
shape = SubResource("WorldBoundaryShape2D_sgjaw")

[node name="WallLeft" type="StaticBody2D" parent="Background"]
position = Vector2(-481, -3)
rotation = 1.5707964

[node name="CollisionShape2D" type="CollisionShape2D" parent="Background/WallLeft"]
shape = SubResource("WorldBoundaryShape2D_sgjaw")

[node name="Freezer" type="Sprite2D" parent="."]
position = Vector2(262, 422)
texture = ExtResource("8_0l1d5")

[node name="Right" type="Sprite2D" parent="."]
position = Vector2(735, 350)
texture = ExtResource("4_5i65a")

[node name="Shelf" type="StaticBody2D" parent="Right"]
position = Vector2(1, -200)
scale = Vector2(1.3168206, 0.8947952)

[node name="CollisionShape2D" type="CollisionShape2D" parent="Right/Shelf"]
shape = SubResource("RectangleShape2D_sgjaw")

[node name="Oven" type="Sprite2D" parent="Right"]
position = Vector2(0, -11)
texture = ExtResource("5_0l1d5")

[node name="Oven_Closed" type="Sprite2D" parent="Right"]
position = Vector2(2, 25)
texture = ExtResource("6_qrew8")

[node name="Oven_Open" type="Sprite2D" parent="Right"]
visible = false
position = Vector2(-13, 230)
texture = ExtResource("7_sgvae")

[node name="Breadroll" type="RigidBody2D" parent="."]
position = Vector2(217, 155)
freeze_mode = 1
script = SubResource("GDScript_ewha7")

[node name="Shape" type="CollisionShape2D" parent="Breadroll"]
position = Vector2(13, 21)
shape = SubResource("CircleShape2D_ca2cv")

[node name="Shape2" type="CollisionShape2D" parent="Breadroll"]
position = Vector2(-8, -9)
shape = SubResource("CircleShape2D_0l1d5")

[node name="Sprite2D" type="Sprite2D" parent="Breadroll"]
texture = ExtResource("3_vgw02")

[node name="DKflag" type="RigidBody2D" parent="."]
position = Vector2(660, 86)
freeze_mode = 1

[node name="Sprite2D" type="Sprite2D" parent="DKflag"]
texture = ExtResource("9_qrew8")

[node name="CollisionPolygon2D" type="CollisionPolygon2D" parent="DKflag"]
polygon = PackedVector2Array(-19.5, -46, -28.5, -46, -28.5, -43, -29.4, -35, -30.2, -35, -30.5, -34.3, -30.5, -33.6, -29.5, -32.6, -29.5, -17.5, -26.5, -15.5, -26.5, -14.200001, -22.5, -13.200001, -22.5, -12, -13.5, -12, -13.5, -10.900002, 6.5, -13.099998, 6.5, -13.799999, 10.400002, -13, 10.5, 19.599998, 6.0999985, 24, 3.9000015, 24, 0.8999996, 29, -0.5, 29, -0.5, 41.5, 2.5, 43.5, 2.5, 44.800003, 11.400002, 47, 22.5, 47, 22.5, 46, 26.099998, 46, 29.099998, 40, 30.5, 40, 30.5, 38.9, 28.5, 31.699997, 28.5, 29.5, 20.900002, 23, 20.5, -42.4, 18.900002, -44, 14.900002, -44, 12.900002, -46, 2.2999992, -46, -5.700001, -42, -11.5, -42, -19.5, -44.7)
